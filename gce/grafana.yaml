grafana.ini:
  auth.anonymous:
    enabled: true
    org_name: Main Org.
    org_role: Editor

service:
  type: LoadBalancer

persistence:
  enabled: true
  storageClassName: standard
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  annotations: {}
  subPath: ""

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
    - name: Prometheus
      type: prometheus
      url: http://prometheus-server.monitoring.svc.cluster.local
      access: proxy
      isDefault: true

dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
    - name: 'default'
      orgId: 1
      folder: ''
      type: file
      disableDeletion: false
      editable: true
      options:
        path: /var/lib/grafana/dashboards/default

dashboards:
  default:
    pangeo:
      json: |
        {"__inputs":[{"name":"DS_RAINTANK","label":"raintank","description":"","type":"datasource","pluginId":"graphite","pluginName":"Graphite"},{"name":"DS_PROMETHEUS","label":"Prometheus","description":"","type":"datasource","pluginId":"prometheus","pluginName":"Prometheus"}],"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"5.2.2"},{"type":"panel","id":"graph","name":"Graph","version":"5.0.0"},{"type":"datasource","id":"graphite","name":"Graphite","version":"5.0.0"},{"type":"panel","id":"neocat-cal-heatmap-panel","name":"Cal-HeatMap","version":"0.0.3"},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"5.0.0"},{"type":"panel","id":"singlestat","name":"Singlestat","version":"5.0.0"}],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"gnetId":null,"graphTooltip":0,"id":null,"links":[],"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":true,"colors":["#890f02","#c15c17","rgba(63, 104, 51, 1)"],"datasource":"${DS_RAINTANK}","decimals":2,"editable":true,"error":false,"format":"percent","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":2,"w":5,"x":0,"y":0},"height":"","id":13,"interval":null,"links":[{"dashUri":"db/worldping-endpoint-web","dashboard":"worldPing Endpoint: |--- Web","includeVars":true,"keepTime":true,"params":"var-protocol=https","title":"worldPing Endpoint: |--- Web","type":"dashboard"}],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"30%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"tableColumn":"","targets":[{"refId":"A","target":"scale(averageSeries(worldping.pangeo_informaticslab_co_uk.london.https.ok_state), 100)"}],"thresholds":"99,99.9","title":"Uptime","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(139, 139, 139, 1)","rgba(139, 139, 139, 1)","rgba(63, 104, 51, 1)"],"datasource":"Prometheus","decimals":0,"editable":true,"error":false,"format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":2,"w":4,"x":5,"y":0},"height":"","id":20,"interval":null,"links":[{"dashUri":"db/worldping-endpoint-web","dashboard":"worldPing Endpoint: |--- Web","includeVars":true,"keepTime":true,"params":"var-protocol=https","title":"worldPing Endpoint: |--- Web","type":"dashboard"}],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"30%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"tableColumn":"","targets":[{"expr":"count(kube_persistentvolumeclaim_resource_requests_storage_bytes{namespace=\"pangeo\",persistentvolumeclaim=~\"claim-.*\"})","format":"time_series","intervalFactor":1,"refId":"A","target":"scale(averageSeries(worldping.pangeo_informaticslab_co_uk.london.https.ok_state), 100)"}],"thresholds":"0,100","timeFrom":null,"title":"Registered users","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(139, 139, 139, 1)","rgba(139, 139, 139, 1)","rgba(63, 104, 51, 1)"],"datasource":"Prometheus","decimals":0,"editable":true,"error":false,"format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":2,"w":4,"x":9,"y":0},"height":"","id":14,"interval":null,"links":[{"dashUri":"db/worldping-endpoint-web","dashboard":"worldPing Endpoint: |--- Web","includeVars":true,"keepTime":true,"params":"var-protocol=https","title":"worldPing Endpoint: |--- Web","type":"dashboard"}],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"30%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"tableColumn":"","targets":[{"expr":"count(kube_pod_info{pod=~\"jupyter-.*\",namespace=\"pangeo\"})","format":"time_series","intervalFactor":1,"refId":"A","target":"scale(averageSeries(worldping.pangeo_informaticslab_co_uk.london.https.ok_state), 100)"}],"thresholds":"0,100","timeFrom":null,"title":"Active users","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"config":{"animationDuration":0,"cellPadding":2,"cellRadius":"0","cellSize":"13","colLimit":"","displayLegend":false,"domain":"day","domainGutter":2,"hoverDecimals":2,"hoverUnitFormat":"short","itemName":["short","short"],"label":{"position":"bottom","rotate":"null","width":60},"legendColors":{"base":"transparent","empty":"rgb(42, 42, 42)","max":"#1f78c1","min":"rgb(50, 54, 58)"},"legendStr":"","legendTitleFormat":{"inner":{},"lower":{},"upper":{}},"rowLimit":null,"subDomain":"auto","subDomainTitleFormat":{"empty":"{date}","filled":{}},"verticalOrientation":false},"datasource":"Prometheus","gridPos":{"h":4,"w":11,"x":13,"y":0},"id":17,"links":[],"targets":[{"expr":"count(kube_pod_info{pod=~\"jupyter-.*\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"timeFrom":"7d","title":"Usage Map","type":"neocat-cal-heatmap-panel"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":"Prometheus","format":"bytes","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":2,"w":5,"x":0,"y":2},"id":19,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"tableColumn":"","targets":[{"expr":"sum(kube_persistentvolumeclaim_resource_requests_storage_bytes{namespace=\"pangeo\",persistentvolumeclaim=~\"claim-.*\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"thresholds":"","timeFrom":null,"title":"Total home directory size","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(139, 139, 139, 1)","rgba(139, 139, 139, 1)","rgba(63, 104, 51, 1)"],"datasource":"Prometheus","decimals":0,"editable":true,"error":false,"format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":2,"w":4,"x":5,"y":2},"height":"","id":21,"interval":null,"links":[{"dashUri":"db/worldping-endpoint-web","dashboard":"","includeVars":true,"keepTime":true,"params":"var-protocol=https","title":"","type":"absolute"}],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"30%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"tableColumn":"","targets":[{"expr":"count(sum by (cluster) (\n    label_replace(\n    rate(\n       kube_pod_info{pod=~\"dask-.*\",namespace=\"pangeo\"}[1h]\n    ), \"cluster\", \"$1\", \"pod\", \"dask-([a-zA-Z0-9]*-.*)-.*\")\n))","format":"time_series","intervalFactor":1,"refId":"A","target":"scale(averageSeries(worldping.pangeo_informaticslab_co_uk.london.https.ok_state), 100)"}],"thresholds":"0,100","title":"Dask clusters","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(139, 139, 139, 1)","rgba(139, 139, 139, 1)","rgba(63, 104, 51, 1)"],"datasource":"Prometheus","decimals":0,"editable":true,"error":false,"format":"short","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":2,"w":4,"x":9,"y":2},"height":"","id":15,"interval":null,"links":[{"dashUri":"db/worldping-endpoint-web","dashboard":"worldPing Endpoint: |--- Web","includeVars":true,"keepTime":true,"params":"var-protocol=https","title":"worldPing Endpoint: |--- Web","type":"dashboard"}],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"30%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"tableColumn":"","targets":[{"expr":"count(kube_pod_info{pod=~\"dask-.*\",namespace=\"pangeo\"})","format":"time_series","intervalFactor":1,"refId":"A","target":"scale(averageSeries(worldping.pangeo_informaticslab_co_uk.london.https.ok_state), 100)"}],"thresholds":"0,100","title":"Dask workers","transparent":false,"type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"current"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":4},"id":2,"panels":[],"title":"Notebooks","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"gridPos":{"h":5,"w":12,"x":0,"y":5},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_pod_name","expr":"sum by (user) (\n    label_replace(\n        rate(container_cpu_user_seconds_total{pod_name=~\"jupyter-.*\",namespace=\"pangeo\"}[1h]), \n             \"user\", \"$1\", \"pod_name\", \"jupyter-([a-zA-Z0-9]*)\"\n    )\n)","format":"time_series","groupBy":[{"params":["pod_name"],"type":"tag"}],"hide":false,"intervalFactor":1,"legendFormat":"{{user}}","measurement":"cpu/usage_rate","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[" / 1000"],"type":"math"}]],"tags":[{"key":"labels","operator":"=","value":"app:jupyterhub,component:singleuser-server,heritage:jupyterhub"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"Cores","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"gridPos":{"h":5,"w":12,"x":12,"y":5},"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_pod_name","expr":"sum by (user) (\n    label_replace(\n        container_memory_usage_bytes{pod_name=~\"jupyter-.*\",namespace=\"pangeo\"}, \"user\", \"$1\", \"pod_name\", \"jupyter-([a-zA-Z0-9]*)\"\n    )\n)","format":"time_series","groupBy":[{"params":["pod_name"],"type":"tag"}],"intervalFactor":1,"legendFormat":"{{user}}","measurement":"memory/usage","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"}]],"tags":[{"key":"labels","operator":"=","value":"app:jupyterhub,component:singleuser-server,heritage:jupyterhub"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Memory usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":10},"id":8,"panels":[],"title":"Dask clusters","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"gridPos":{"h":5,"w":12,"x":0,"y":11},"id":5,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_pod_name","expr":"sum by (cluster) (\n    label_replace(\n    rate(\n       container_cpu_user_seconds_total{pod_name=~\"dask-.*-.*\",namespace=\"pangeo\"}[1h]\n    ), \"cluster\", \"$1\", \"pod_name\", \"dask-([a-zA-Z0-9]*-.*)-.*\")\n)","format":"time_series","groupBy":[{"params":["pod_name"],"type":"tag"}],"hide":false,"intervalFactor":1,"legendFormat":"{{cluster}}","measurement":"cpu/usage_rate","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[" / 1000"],"type":"math"}]],"tags":[{"key":"labels","operator":"=","value":"app:jupyterhub,component:singleuser-server,heritage:jupyterhub"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"Cores","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"Prometheus","fill":1,"gridPos":{"h":5,"w":12,"x":12,"y":11},"id":9,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_pod_name","expr":"sum by (cluster) (\n    label_replace(\n       container_memory_usage_bytes{pod_name=~\"dask-.*\",namespace=\"pangeo\"}, \"cluster\", \"$1\", \"pod_name\", \"dask-([a-zA-Z0-9]*-.*)-.*\"\n       )\n)","format":"time_series","groupBy":[{"params":["pod_name"],"type":"tag"}],"intervalFactor":1,"legendFormat":"{{cluster}}","measurement":"memory/usage","orderByTime":"ASC","policy":"default","refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"}]],"tags":[{"key":"labels","operator":"=","value":"app:jupyterhub,component:singleuser-server,heritage:jupyterhub"}]}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Memory usage","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":"30s","schemaVersion":16,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-24h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Pangeo","uid":"fwbkW3ezk","version":26}
    prometheus-stats:
      gnetId: 2
      revision: 2
      datasource: Prometheus
    kubernetes-stats:
      gnetId: 6417
      revision: 1
      datasource: Prometheus
